000001 0000                  ;****************************************
000002 0000                  ;	   PROGRAMA MONITOR NESTOR
000003 0000                  ;	       NOVA ELETRÔNICA
000004 0000                  ;	SAO PAULO S.P. 01/84 MSCS/JRP
000005 0000                  ;****************************************
000006 0000                  
000007 0003                  .equ	PDIG,	h'03	; saída coluna teclado e display
000008 0001                  .equ	PSEG,	h'01	; saída caracter para o display
000009 0001                  .equ	PTEC,	h'01	; entrada linha teclado
000010 0001                  .equ	ATRASO,	h'0001
000011 0000                  
000012 0000                  	.org	h'0000
000013 0000 31000C           	ld	sp, CURRMSG
000014 0003 C5               	push	bc
000015 0004 D5               	push	de
000016 0005 E5               	push	hl
000017 0006 F5               	push	af
000018 0007 21E60B           	ld	hl, FLAG
000019 000A 3619             	ld	(hl), h'19
000020 000C 215C00           	ld	hl, MENS
000021 000F 11E70B           	ld	de, BUFDISP
000022 0012 010600           	ld	bc, h'0006
000023 0015 EDB0             	ldir
000024 0017 31E40B           INICIO:	ld	sp, TOPSP
000025 001A 21E70B           	ld	hl, BUFDISP
000026 001D 0600             	ld	b, h'00
000027 001F 1E06             	ld	e, h'06
000028 0021 3E01             	ld	a, h'01
000029 0023 CD8F00           NE1:	call	VARR
000030 0026 79               	ld	a, c
000031 0027 87               	add	a, a
000032 0028 1D               	dec	e
000033 0029 C22300           	jp	nz, NE1
000034 002C 78               	ld	a, b
000035 002D FE00             	cp	h'00
000036 002F CA1700           	jp	z, INICIO
000037 0032 21E70B           NE2:	ld	hl, BUFDISP
000038 0035 CD9B00           	call	REST
000039 0038 7A               	ld	a, d
000040 0039 D303             	out	(PDIG), a
000041 003B DB01             	in	a, (PTEC)
000042 003D FE00             	cp	h'00
000043 003F C23200           	jp	nz, NE2
000044 0042 CDBC00           	call	AJCOL
000045 0045 CDD700           	call	AJTEC
000046 0048 FE13             	cp	h'13
000047 004A CA7700           	jp	z, NE3
000048 004D FE10             	cp	h'10
000049 004F DA8300           	jp	c, NE4
000050 0052 CDEF00           NE5:	call	ALTCOM
000051 0055 21E60B           NE6:	ld	hl, FLAG
000052 0058 7E               	ld	a, (hl)
000053 0059 C36900           	jp	RECCOM
000054 005C                  
000055 005C                  ;****************************************
000056 005C                  ;  MENSAGEM INICIAL
000057 005C                  ;****************************************
000058 005C                  
000059 005C C8               MENS:	.db	h'C8	; N
000060 005D 86               		.db	h'86	; E
000061 005E 92               		.db	h'92	; S
000062 005F 87               		.db	h'87	; T
000063 0060 C0               		.db	h'C0	; O
000064 0061 CE               		.db	h'CE	; R
000065 0062                  
000066 0062                  ;****************************************
000067 0062                  ;  PONTO DE ENTRADA DE INTERRUPÇÃO NMI
000068 0062                  ;****************************************
000069 0062                  
000070 0066                  	.org	h'0066
000071 0066 C3F20B           NMINT:	jp	ROTNMI
000072 0069                  
000073 0069                  ;****************************************
000074 0069                  ;  ROTINA DE RECONHECIMENTO DE COMANDOS
000075 0069                  ;****************************************
000076 0069                  
000077 0069 211C03           RECCOM:	ld	hl, TABCOM+1
000078 006C 85               	add	a, l
000079 006D 6F               	ld	l, a
000080 006E 7E               	ld	a, (hl)
000081 006F 4F               	ld	c, a
000082 0070 3E0A             	ld	a, h'0A
000083 0072 85               	add	a, l
000084 0073 6F               	ld	l, a
000085 0074 6E               	ld	l, (hl)
000086 0075 61               	ld	h, c
000087 0076 E9               	jp	(hl)
000088 0077 21E60B           NE3:	ld	hl, FLAG
000089 007A 7E               	ld	a, (hl)
000090 007B FE15             	cp	h'15
000091 007D CAF001           	jp	z, SELREG
000092 0080 C35200           	jp	NE5
000093 0083 21E60B           NE4:	ld	hl, FLAG
000094 0086 7E               	ld	a, (hl)
000095 0087 FE15             	cp	h'15
000096 0089 CA0102           	jp	z, ALTREG
000097 008C                  	;nop
000098 008C C35500           	jp	NE6
000099 008F                  
000100 008F                  ;****************************************
000101 008F                  ;	ROTINA DE VARREDURA
000102 008F                  ;****************************************
000103 008F                  
000104 008F 4F               VARR:	ld	c, a
000105 0090 CDA800           	call	TEMPO
000106 0093 DB01             	in	a, (PTEC)
000107 0095 FE00             	cp	h'00
000108 0097 C8               	ret	z
000109 0098 47               	ld	b, a
000110 0099 51               	ld	d, c
000111 009A C9               	ret
000112 009B                  
000113 009B                  ;****************************************
000114 009B                  ;	ROTINA DE RESTAURAÇÃO
000115 009B                  ;****************************************
000116 009B                  
000117 009B 0E06             REST:	ld	c, h'06
000118 009D 3E01             	ld	a, h'01
000119 009F CDA800           NE7:	call	TEMPO
000120 00A2 87               	add	a, a
000121 00A3 0D               	dec	c
000122 00A4 C8               	ret	z
000123 00A5 C39F00           	jp	NE7
000124 00A8                  
000125 00A8                  ;****************************************
000126 00A8                  ;	ROTINA DE TEMPO
000127 00A8                  ;****************************************
000128 00A8                  
000129 00A8 F5               TEMPO:	push	af
000130 00A9 D303             	out	(PDIG), a
000131 00AB 7E               	ld	a, (hl)
000132 00AC D301             	out	(PSEG), a
000133 00AE D9               	exx
000134 00AF 110100           	ld	de, ATRASO
000135 00B2 1B               LOOP1:	dec	de
000136 00B3 7A               	ld	a, d
000137 00B4 B3               	or	e
000138 00B5 C2B200           	jp	nz, LOOP1
000139 00B8 D9               	exx
000140 00B9 23               	inc	hl
000141 00BA F1               	pop	af
000142 00BB C9               	ret
000143 00BC                  
000144 00BC                  ;****************************************
000145 00BC                  ;	ROTINA DE AJUSTE DE COLUNA
000146 00BC                  ;****************************************
000147 00BC                  
000148 00BC 0E00             AJCOL:	ld	c, h'00
000149 00BE 3E01             	ld	a, h'01
000150 00C0 BA               	cp	d
000151 00C1 CAD500           	jp	z, NE8
000152 00C4 87               	add	a, a
000153 00C5 0E08             	ld	c, h'08
000154 00C7 BA               	cp	d
000155 00C8 CAD500           	jp	z, NE8
000156 00CB 87               	add	a, a
000157 00CC 0E10             	ld	c, h'10
000158 00CE BA               	cp	d
000159 00CF CAD500           	jp	z, NE8
000160 00D2 C31700           	jp	INICIO
000161 00D5 51               NE8:	ld	d, c
000162 00D6 C9               	ret
000163 00D7                  
000164 00D7                  ;****************************************
000165 00D7                  ;	ROTINA DE AJUSTE DE TECLA
000166 00D7                  ;****************************************
000167 00D7                  
000168 00D7 1E08             AJTEC:	ld	e, h'08
000169 00D9 0E00             	ld	c, h'00
000170 00DB 3E01             	ld	a, h'01
000171 00DD B8               NE10:	cp	b
000172 00DE CAEA00           	jp	z, NE9
000173 00E1 0C               	inc	c
000174 00E2 87               	add	a, a
000175 00E3 1D               	dec	e
000176 00E4 C2DD00           	jp	nz, NE10
000177 00E7 C31700           	jp	INICIO
000178 00EA 79               NE9:	ld	a, c
000179 00EB 82               	add	a, d
000180 00EC 47               	ld	b, a
000181 00ED 00               	nop
000182 00EE C9               	ret
000183 00EF                  
000184 00EF                  ;****************************************
000185 00EF                  ;	ROTINA DE ALTERAR COMANDO
000186 00EF                  ;****************************************
000187 00EF                  
000188 00EF 21E60B           ALTCOM:	ld	hl, FLAG
000189 00F2 70               	ld	(hl), b
000190 00F3 C9               	ret
000191 00F4                  
000192 00F4                  ;****************************************
000193 00F4                  ;	ROTINA DE PERMISSÃO
000194 00F4                  ;****************************************
000195 00F4                  
000196 00F4 0E06             ROTPER:	ld	c, h'06
000197 00F6 21E60B           	ld	hl, FLAG
000198 00F9 3617             	ld	(hl), h'17	; executando a rotina "Permissão"
000199 00FB 23               	inc	hl
000200 00FC 36C0             NE11:	ld	(hl), h'C0	; h'FF
000201 00FE 23               	inc	hl
000202 00FF 0D               	dec	c
000203 0100 C2FC00           	jp	nz, NE11
000204 0103 3600             	ld	(hl), h'00
000205 0105 23               	inc	hl
000206 0106 3600             	ld	(hl), h'00
000207 0108 23               	inc	hl
000208 0109 3600             	ld	(hl), h'00
000209 010B C31700           	jp	INICIO
000210 010E                  
000211 010E                  ;****************************************
000212 010E                  ;	ROTINA DE CAMPO DE ENDEREÇOS
000213 010E                  ;****************************************
000214 010E                  
000215 010E 21EE0B           ROTCP:	ld	hl, PBE
000216 0111 78               	ld	a, b
000217 0112 ED6F             	rld	; A(LSB)->(HL)(LSB)->(HL)(LSB)->(HL)(MSB)->(HL)(MSB)->A(LSB)
000218 0114 23               	inc	hl
000219 0115 ED6F             	rld	; A(LSB)->(HL)(LSB)->(HL)(LSB)->(HL)(MSB)->(HL)(MSB)->A(LSB)
000220 0117 CD5101           	call	DECOD
000221 011A C31700           	jp	INICIO
000222 011D                  
000223 011D                  ;****************************************
000224 011D                  ;	ROTINA DE LEITURA
000225 011D                  ;****************************************
000226 011D                  
000227 011D CD3F01           ROTLT:	call	ATUAL
000228 0120 21E60B           	ld	hl, FLAG
000229 0123 3618             	ld	(hl), h'18
000230 0125 21EF0B           	ld	hl, PAE
000231 0128 CD5101           	call	DECOD
000232 012B C31700           	jp	INICIO
000233 012E                  
000234 012E                  ;****************************************
000235 012E                  ;	ROTINA DE CAMPO DE DADOS
000236 012E                  ;****************************************
000237 012E                  
000238 012E CD3F01           ROTCD:	call	ATUAL
000239 0131 78               	ld	a, b
000240 0132 ED6F             	rld	; A(LSB)->(HL)(LSB)->(HL)(LSB)->(HL)(MSB)->(HL)(MSB)->A(LSB)
000241 0134 7E               	ld	a, (hl)
000242 0135 12               	ld	(de), a
000243 0136 21EF0B           	ld	hl, PAE
000244 0139 CD5101           	call	DECOD
000245 013C C31700           	jp	INICIO
000246 013F                  
000247 013F                  ;****************************************
000248 013F                  ;	ROTINA DE ATUALIZAÇÃO
000249 013F                  ;****************************************
000250 013F                  
000251 013F 21EE0B           ATUAL:	ld	hl, PBE
000252 0142 5E               	ld	e, (hl)
000253 0143 23               	inc	hl
000254 0144 56               	ld	d, (hl)
000255 0145 1A               	ld	a, (de)
000256 0146 2B               	dec	hl
000257 0147 2B               	dec	hl
000258 0148 77               	ld	(hl), a
000259 0149 E5               	push	hl
000260 014A 21E60B           	ld	hl, FLAG
000261 014D 3618             	ld	(hl), h'18
000262 014F E1               	pop	hl
000263 0150 C9               	ret
000264 0151                  
000265 0151                  ;****************************************
000266 0151                  ;	ROTINA DE DECODIFICAÇÃO
000267 0151                  ;****************************************
000268 0151                  
000269 0151 01E70B           DECOD:	ld	bc, BUFDISP
000270 0154 CD6B01           	call	DISPLY
000271 0157 2B               	dec	hl
000272 0158 CD6B01           	call	DISPLY
000273 015B 2B               	dec	hl
000274 015C CD6B01           	call	DISPLY
000275 015F C9               	ret
000276 0160                  
000277 0160                  ;****************************************
000278 0160                  ;  ROTINA DE AJUSTE MEMÓRIA DE ENDEREÇO
000279 0160                  ;****************************************
000280 0160                  
000281 0160 21EE0B           RAME:	ld	hl, PBE
000282 0163 73               	ld	(hl), e
000283 0164 23               	inc	hl
000284 0165 72               	ld	(hl), d
000285 0166 2B               	dec	hl
000286 0167 2B               	dec	hl
000287 0168 1A               	ld	a, (de)
000288 0169 77               	ld	(hl), a
000289 016A C9               	ret
000290 016B                  
000291 016B                  ;****************************************
000292 016B                  ;	ROTINA DE DISPLY
000293 016B                  ;****************************************
000294 016B                  
000295 016B 7E               DISPLY:	ld	a, (hl)
000296 016C E5               	push	hl
000297 016D 21F00B           	ld	hl, ROT
000298 0170 77               	ld	(hl), a
000299 0171 AF               	xor	a
000300 0172 ED6F             	rld	; A(LSB)->(HL)(LSB)->(HL)(LSB)->(HL)(MSB)->(HL)(MSB)->A(LSB)
000301 0174 CD8301           	call	FORMAT
000302 0177 02               	ld	(bc), a
000303 0178 03               	inc	bc
000304 0179 AF               	xor	a
000305 017A ED6F             	rld	; A(LSB)->(HL)(LSB)->(HL)(LSB)->(HL)(MSB)->(HL)(MSB)->A(LSB)
000306 017C CD8301           	call	FORMAT
000307 017F 02               	ld	(bc), a
000308 0180 03               	inc	bc
000309 0181 E1               	pop	hl
000310 0182 C9               	ret
000311 0183                  
000312 0183                  ;****************************************
000313 0183                  ;	ROTINA DE FORMATAÇÃO
000314 0183                  ;****************************************
000315 0183                  
000316 0183 D5               FORMAT:	push	de
000317 0184 118C01           	ld	de, INTD
000318 0187 83               	add	a, e
000319 0188 5F               	ld	e, a
000320 0189 1A               	ld	a, (de)
000321 018A D1               	pop	de
000322 018B C9               	ret
000323 018C                  
000324 018C                  ;****************************************
000325 018C                  ;	TABELA DE FORMATOS ALFA (NÚMEROS)
000326 018C                  ;****************************************
000327 018C                  
000328 018C C0               INTD:	.db	h'C0
000329 018D F9               	.db	h'F9
000330 018E A4               	.db	h'A4
000331 018F B0               	.db	h'B0
000332 0190 99               	.db	h'99
000333 0191 92               	.db	h'92
000334 0192 82               	.db	h'82
000335 0193 F8               	.db	h'F8
000336 0194 80               	.db	h'80
000337 0195 90               	.db	h'90
000338 0196 88               	.db	h'88
000339 0197 83               	.db	h'83
000340 0198 C6               	.db	h'C6
000341 0199 A1               	.db	h'A1
000342 019A 86               	.db	h'86
000343 019B 8E               	.db	h'8E
000344 019C                  
000345 019C                  ;****************************************
000346 019C                  ;	ROTINA DE PRÓXIMO
000347 019C                  ;****************************************
000348 019C                  
000349 019C CD3F01           ROTPR:	call	ATUAL
000350 019F 13               	inc	de
000351 01A0 CD6001           	call	RAME
000352 01A3 21EF0B           	ld	hl, PAE
000353 01A6 CD5101           	call	DECOD
000354 01A9 C31700           	jp	INICIO
000355 01AC                  
000356 01AC                  ;****************************************
000357 01AC                  ;	ROTINA DE ÚLTIMO
000358 01AC                  ;****************************************
000359 01AC                  
000360 01AC CD3F01           ROTUL:	call	ATUAL
000361 01AF 1B               	dec	de
000362 01B0 CD6001           	call	RAME
000363 01B3 21EF0B           	ld	hl, PAE
000364 01B6 CD5101           	call	DECOD
000365 01B9 C31700           	jp	INICIO
000366 01BC                  
000367 01BC                  ;****************************************
000368 01BC                  ;	ROTINA DE RODAR
000369 01BC                  ;****************************************
000370 01BC                  
000371 01BC                  ; para ajustar a posição das rotinas de exame de registradores
000372 01BC 0000000000000000 	.dw	0, 0, 0, 0
000373 01C4                  
000374 01C4 3EFF             ROTRD:	ld	a, h'FF
000375 01C6 D303             	out	(PDIG), a
000376 01C8 3E7F             	ld	a, h'7F
000377 01CA D301             	out	(PSEG), a
000378 01CC 21ED0B           	ld	hl, ENDISP
000379 01CF 36C3             	ld	(hl), h'C3	; h'C3 = "jp"
000380 01D1 31F80B           	ld	sp, MENF
000381 01D4 F5               	push	af
000382 01D5 E5               	push	hl
000383 01D6 D5               	push	de
000384 01D7 C5               	push	bc
000385 01D8 31E40B           	ld	sp, TOPSP
000386 01DB C3ED0B           	jp	ENDISP
000387 01DE                  
000388 01DE                  ;****************************************
000389 01DE                  ;    ROTINA DE EXAME DE REGISTRADORES
000390 01DE                  ;****************************************
000391 01DE                  
000392 01DE 21E50B           ROTER:	ld	hl, MENCON
000393 01E1 36FE             	ld	(hl), h'FE
000394 01E3 C3F001           	jp	SELREG
000395 01E6                  
000396 01E6                  ;****************************************
000397 01E6                  ;	ROTINA DE INICIALIZAÇÃO
000398 01E6                  ;****************************************
000399 01E6                  
000400 01E6 21E70B           INICIAL:	ld	hl, BUFDISP
000401 01E9 36FF             	ld	(hl), h'FF
000402 01EB 23               	inc	hl
000403 01EC 36FF             	ld	(hl), h'FF
000404 01EE 23               	inc	hl
000405 01EF C9               	ret
000406 01F0                  
000407 01F0                  ;****************************************
000408 01F0                  ;   ROTINA DE SELEÇÃO DE REGISTRADORES
000409 01F0                  ;****************************************
000410 01F0                  
000411 01F0 110003           SELREG:	ld	de, TABREG
000412 01F3 21E50B           	ld	hl, MENCON
000413 01F6 34               	inc	(hl)
000414 01F7 34               	inc	(hl)
000415 01F8 7B               	ld	a, e
000416 01F9 86               	add	a, (hl)
000417 01FA 5F               NE12:	ld	e, a
000418 01FB 1A               	ld	a, (de)
000419 01FC 6F               	ld	l, a
000420 01FD 13               	inc	de
000421 01FE 1A               	ld	a, (de)
000422 01FF 67               	ld	h, a
000423 0200 E9               	jp	(hl)
000424 0201                  
000425 0201                  ;****************************************
000426 0201                  ;  ROTINA DE ALTERAÇÃO DE REGISTRADORES
000427 0201                  ;****************************************
000428 0201                  
000429 0201 21E50B           ALTREG:	ld	hl, MENCON
000430 0204 111703           	ld	de, TABALT
000431 0207 7B               	ld	a, e
000432 0208 86               	add	a, (hl)
000433 0209 C3FA01           	jp	NE12
000434 020C                  
000435 020C                  ;****************************************
000436 020C                  ;	REGISTRADOR A
000437 020C                  ;****************************************
000438 020C                  
000439 020C CDE601           REGA:	call	INICIAL
000440 020F 3688             	ld	(hl), h'88
000441 0211 23               	inc	hl
000442 0212 36B7             	ld	(hl), h'B7
000443 0214 21F90B           	ld	hl, MENA
000444 0217 C31A02           	jp	ROTSA
000445 021A                  
000446 021A                  ;****************************************
000447 021A                  ;	ROTINA DE SAÍDA
000448 021A                  ;****************************************
000449 021A                  
000450 021A 01EB0B           ROTSA:	ld	bc, BYTES
000451 021D CD6B01           	call	DISPLY
000452 0220 C31700           	jp	INICIO
000453 0223                  
000454 0223                  ;****************************************
000455 0223                  ;	ALTERA REGISTRADOR A
000456 0223                  ;****************************************
000457 0223                  
000458 0223 21F90B           ALTA:	ld	hl, MENA
000459 0226 78               	ld	a, b
000460 0227 ED6F             	rld	; A(LSB)->(HL)(LSB)->(HL)(LSB)->(HL)(MSB)->(HL)(MSB)->A(LSB)
000461 0229 C31A02           	jp	ROTSA
000462 022C                  
000463 022C                  ;****************************************
000464 022C                  ;	REGISTRADOR B
000465 022C                  ;****************************************
000466 022C                  
000467 022C CDE601           REGB:	call	INICIAL
000468 022F 3683             	ld	(hl), h'83
000469 0231 23               	inc	hl
000470 0232 36B7             	ld	(hl), h'B7
000471 0234 21FF0B           	ld	hl, MENB
000472 0237 C31A02           	jp	ROTSA
000473 023A                  
000474 023A                  ;****************************************
000475 023A                  ;	ALTERA REGISTRADOR B
000476 023A                  ;****************************************
000477 023A                  
000478 023A 21FF0B           ALTB:	ld	hl, MENB
000479 023D 78               	ld	a, b
000480 023E ED6F             	rld	; A(LSB)->(HL)(LSB)->(HL)(LSB)->(HL)(MSB)->(HL)(MSB)->A(LSB)
000481 0240 C31A02           	jp	ROTSA
000482 0243                  
000483 0243                  ;****************************************
000484 0243                  ;	REGISTRADOR C
000485 0243                  ;****************************************
000486 0243                  
000487 0243 CDE601           REGC:	call	INICIAL
000488 0246 36C6             	ld	(hl), h'C6
000489 0248 23               	inc	hl
000490 0249 36B7             	ld	(hl), h'B7
000491 024B 21FE0B           	ld	hl, MENC
000492 024E C31A02           	jp	ROTSA
000493 0251                  
000494 0251                  ;****************************************
000495 0251                  ;	ALTERA REGISTRADOR C
000496 0251                  ;****************************************
000497 0251                  
000498 0251 21FE0B           ALTC:	ld	hl, MENC
000499 0254 78               	ld	a, b
000500 0255 ED6F             	rld	; A(LSB)->(HL)(LSB)->(HL)(LSB)->(HL)(MSB)->(HL)(MSB)->A(LSB)
000501 0257 C31A02           	jp	ROTSA
000502 025A                  
000503 025A                  ;****************************************
000504 025A                  ;	REGISTRADOR D
000505 025A                  ;****************************************
000506 025A                  
000507 025A CDE601           REGD:	call	INICIAL
000508 025D 36A1             	ld	(hl), h'A1
000509 025F 23               	inc	hl
000510 0260 36B7             	ld	(hl), h'B7
000511 0262 21FD0B           	ld	hl, MEND
000512 0265 C31A02           	jp	ROTSA
000513 0268                  
000514 0268                  ;****************************************
000515 0268                  ;	ALTERA REGISTRADOR D
000516 0268                  ;****************************************
000517 0268                  
000518 0268 21FD0B           ALTD:	ld	hl, MEND
000519 026B 78               	ld	a, b
000520 026C ED6F             	rld	; A(LSB)->(HL)(LSB)->(HL)(LSB)->(HL)(MSB)->(HL)(MSB)->A(LSB)
000521 026E C31A02           	jp	ROTSA
000522 0271                  
000523 0271                  ;****************************************
000524 0271                  ;	REGISTRADOR E
000525 0271                  ;****************************************
000526 0271                  
000527 0271 CDE601           REGE:	call	INICIAL
000528 0274 3686             	ld	(hl), h'86
000529 0276 23               	inc	hl
000530 0277 36B7             	ld	(hl), h'B7
000531 0279 21FC0B           	ld	hl, MENE
000532 027C C31A02           	jp	ROTSA
000533 027F                  
000534 027F                  ;****************************************
000535 027F                  ;	ALTERA REGISTRADOR E
000536 027F                  ;****************************************
000537 027F                  
000538 027F 21FC0B           ALTE:	ld	hl, MENE
000539 0282 78               	ld	a, b
000540 0283 ED6F             	rld	; A(LSB)->(HL)(LSB)->(HL)(LSB)->(HL)(MSB)->(HL)(MSB)->A(LSB)
000541 0285 C31A02           	jp	ROTSA
000542 0288                  
000543 0288                  ;****************************************
000544 0288                  ;	REGISTRADOR H
000545 0288                  ;****************************************
000546 0288                  
000547 0288 CDE601           REGH:	call	INICIAL
000548 028B 3689             	ld	(hl), h'89
000549 028D 23               	inc	hl
000550 028E 36B7             	ld	(hl), h'B7
000551 0290 21FB0B           	ld	hl, MENH
000552 0293 C31A02           	jp	ROTSA
000553 0296                  
000554 0296                  ;****************************************
000555 0296                  ;	ALTERA REGISTRADOR H
000556 0296                  ;****************************************
000557 0296                  
000558 0296 21FB0B           ALTH:	ld	hl, MENH
000559 0299 78               	ld	a, b
000560 029A ED6F             	rld	; A(LSB)->(HL)(LSB)->(HL)(LSB)->(HL)(MSB)->(HL)(MSB)->A(LSB)
000561 029C C31A02           	jp	ROTSA
000562 029F                  
000563 029F                  ;****************************************
000564 029F                  ;	REGISTRADOR L
000565 029F                  ;****************************************
000566 029F                  
000567 029F CDE601           REGL:	call	INICIAL
000568 02A2 36C7             	ld	(hl), h'C7
000569 02A4 23               	inc	hl
000570 02A5 36B7             	ld	(hl), h'B7
000571 02A7 21FA0B           	ld	hl, MENL
000572 02AA C31A02           	jp	ROTSA
000573 02AD                  
000574 02AD                  ;****************************************
000575 02AD                  ;	ALTERA REGISTRADOR L
000576 02AD                  ;****************************************
000577 02AD                  
000578 02AD 21FA0B           ALTL:	ld	hl, MENL
000579 02B0 78               	ld	a, b
000580 02B1 ED6F             	rld	; A(LSB)->(HL)(LSB)->(HL)(LSB)->(HL)(MSB)->(HL)(MSB)->A(LSB)
000581 02B3 C31A02           	jp	ROTSA
000582 02B6                  
000583 02B6                  ;****************************************
000584 02B6                  ;	REGISTRADOR F
000585 02B6                  ;****************************************
000586 02B6                  
000587 02B6 CDE601           REGF:	call	INICIAL
000588 02B9 368E             	ld	(hl), h'8E
000589 02BB 23               	inc	hl
000590 02BC 36B7             	ld	(hl), h'B7
000591 02BE 21F80B           	ld	hl, MENF
000592 02C1 C31A02           	jp	ROTSA
000593 02C4                  
000594 02C4                  ;****************************************
000595 02C4                  ;	ALTERA REGISTRADOR F
000596 02C4                  ;****************************************
000597 02C4                  
000598 02C4 21F80B           ALTF:	ld	hl, MENF
000599 02C7 78               	ld	a, b
000600 02C8 ED6F             	rld	; A(LSB)->(HL)(LSB)->(HL)(LSB)->(HL)(MSB)->(HL)(MSB)->A(LSB)
000601 02CA C31A02           	jp	ROTSA
000602 02CD                  
000603 02CD                  ;****************************************
000604 02CD                  ;	REGISTRADOR I
000605 02CD                  ;****************************************
000606 02CD                  
000607 02CD ED57             REGI:	ld	a, i
000608 02CF 21F70B           	ld	hl, MENI
000609 02D2 77               	ld	(hl), a
000610 02D3 CDE601           	call	INICIAL
000611 02D6 36F9             	ld	(hl), h'F9
000612 02D8 23               	inc	hl
000613 02D9 36B7             	ld	(hl), h'B7
000614 02DB 21F70B           	ld	hl, MENI
000615 02DE C31A02           	jp	ROTSA
000616 02E1                  
000617 02E1                  ;****************************************
000618 02E1                  ;	ALTERA REGISTRADOR I
000619 02E1                  ;****************************************
000620 02E1                  
000621 02E1 21F70B           ALTI:	ld	hl, MENI
000622 02E4 78               	ld	a, b
000623 02E5 ED6F             	rld	; A(LSB)->(HL)(LSB)->(HL)(LSB)->(HL)(MSB)->(HL)(MSB)->A(LSB)
000624 02E7 7E               	ld	a, (hl)
000625 02E8 ED47             	ld	i, a
000626 02EA C31A02           	jp	ROTSA
000627 02ED                  
000628 02ED                  ;****************************************
000629 02ED                  ;   ROTINA PARA O VETOR DE INTERRUPÇÃO
000630 02ED                  ;****************************************
000631 02ED                  
000632 02ED 01F20B           RIV:	ld	bc, ROTNMI
000633 02F0 3EC3             	ld	a, h'C3		; h'C3 = "jp"
000634 02F2 02               	ld	(bc), a
000635 02F3 03               	inc	bc
000636 02F4 21EE0B           	ld	hl, PBE
000637 02F7 7E               	ld	a, (hl)
000638 02F8 02               	ld	(bc), a
000639 02F9 03               	inc	bc
000640 02FA 23               	inc	hl
000641 02FB 7E               	ld	a, (hl)
000642 02FC 02               	ld	(bc), a
000643 02FD C36D03           	jp	OK ; INICIO
000644 0300                  
000645 0300                  ;****************************************
000646 0300                  ;   TABELA DE SELEÇÃO DE REGISTRADORES
000647 0300                  ;****************************************
000648 0300                  
000649 0300 020C             TABREG:	.dw	REGA
000650 0302 022C             	.dw	REGB
000651 0304 0243             	.dw	REGC
000652 0306 025A             	.dw	REGD
000653 0308 0271             	.dw	REGE
000654 030A 0288             	.dw	REGH
000655 030C 029F             	.dw	REGL
000656 030E 02B6             	.dw	REGF
000657 0310 02CD             	.dw	REGI
000658 0312 0002             	.dw	h'+2
000659 0314 C3DE01           	jp	ROTER
000660 0317                  
000661 0317                  ;****************************************
000662 0317                  ;  TABELA DE ALTERAÇÃO DE REGISTRADORES
000663 0317                  ;****************************************
000664 0317                  
000665 0317 0223             TABALT:	.dw	ALTA
000666 0319 023A             	.dw	ALTB
000667 031B 0251             TABCOM:	.dw	ALTC
000668 031D 0268             	.dw	ALTD
000669 031F 027F             	.dw	ALTE
000670 0321 0296             	.dw	ALTH
000671 0323 02AD             	.dw	ALTL
000672 0325 02C4             	.dw	ALTF
000673 0327 02E1             	.dw	ALTI
000674 0329 0000             	.dw	h'00
000675 032B 00               	.db	h'00
000676 032C                  
000677 032C                  ;****************************************
000678 032C                  ;   TABELA DE SELEÇÃO DE COMANDOS
000679 032C                  ;****************************************
000680 032C                  
000681 032C 00               	.db	(ROTPER >> 8) & h'FF	; ROTPER (MSB)
000682 032D 01               	.db	(ROTLT >> 8) & h'FF	; ROTLT (MSB)
000683 032E 01               	.db	(ROTUL >> 8) & h'FF	; ROTUL (MSB)
000684 032F 01               	.db	(ROTPR >> 8) & h'FF	; ROTPR (MSB)
000685 0330 01               	.db	(ROTRD >> 8) & h'FF	; ROTRD (MSB)
000686 0331 01               	.db	(ROTER >> 8) & h'FF	; ROTER (MSB)
000687 0332 02               	.db	(RIV >> 8) & h'FF	; RIV (MSB)
000688 0333 01               	.db	(ROTCP >> 8) & h'FF	; ROTCP (MSB)
000689 0334 01               	.db	(ROTCD >> 8) & h'FF	; ROTCD (MSB)
000690 0335 00               	.db	(INICIO >> 8) & h'FF	; INICIO (MSB)
0006 91 0336 F4               	.db	ROTPER & h'FF		; ROTPER (LSB)
000692 0337 1D               	.db	ROTLT & h'FF		; ROTLT (LSB)
000693 0338 AC               	.db	ROTUL & h'FF		; ROTUL (LSB)
000694 0339 9C               	.db	ROTPR & h'FF		; ROTPR (LSB)
000695 033A C4               	.db	ROTRD & h'FF		; ROTRD (LSB)
000696 033B DE               	.db	ROTER & h'FF		; ROTER (LSB)
000697 033C ED               	.db	RIV & h'FF		; RIV (LSB)
000698 033D 0E               	.db	ROTCP & h'FF		; ROTCP (LSB)
000699 033E 2E               	.db	ROTCD & h'FF		; ROTCD (LSB)
000700 033F 17               	.db	INICIO & h'FF		; INICIO (LSB)
000701 0340                  
000702 0340 22000C           DELAY:	ld	(CURRMSG), hl
000703 0343 C5               	push	bc		; save BC
000704 0344 CD4903           	call	DELAY1
000705 0347 C1               	pop	bc		; restore BC
000706 0348 C9               	ret
000707 0349 0E05             DELAY1:	ld	c, h'05		; fill c too with max delay
000708 034B 2A000C           DELAY2:	ld	hl, (CURRMSG)
000709 034E C5               	push	bc
000710 034F CD9B00           	call	REST
000711 0352 C1               	pop	bc
000712 0353 0D               	dec	c
000713 0354 C24B03           	jp	nz, DELAY2
000714 0357 C9               	ret			; retorna
000715 0358 3EFF             INVALID:	ld	a, h'FF		; todos os LED's
000716 035A D304             	out	(h'04), a		; acende LED's
000717 035C D305             	out	(h'05), a
000718 035E 217603           	ld	hl, INVAMSG
000719 0361 CD4003           	call	DELAY
000720 0364 3E00             	ld	a, h'00
000721 0366 D304             	out	(h'04), a
000722 0368 D305             	out	(h'05), a
000723 036A C31700           	jp	INICIO
000724 036D 217C03           OK:	ld	hl, OKMSG
000725 0370 CD4003           	call	DELAY
000726 0373 C31700           	jp	INICIO
000727 0376 F9C8C188C7FF     INVAMSG:	.db	h'F9, h'C8, h'C1, h'88, h'C7, h'FF
000728 037C C08AFFFFFFFF     OKMSG:	.db	h'C0, h'8A, h'FF, h'FF, h'FF, h'FF
000729 0382                  
000730 0BE4                  	.org	h'0BE4
000731 0BE4 00               TOPSP:	.db	0	;equ	h'0BE4
000732 0BE5 00               MENCON:	.db	0	;equ	h'0BE5
000733 0BE6 00               FLAG:	.db	0	;equ	h'0BE6
000734 0BE7 00000000         BUFDISP:	.dw	0, 0	;equ	h'0BE7
000735 0BEB 0000             BYTES:	.dw	0	;equ	h'0BEB
000736 0BED 00               ENDISP:	.db	0	;equ	h'0BED
000737 0BEE 00               PBE:	.db	0	;equ	h'0BEE
000738 0BEF 00               PAE:	.db	0	;equ	h'0BEF
000739 0BF0 0000             ROT:	.dw	0	;equ	h'0BF0
000740 0BF2 C30000           ROTNMI:	jp	0	;equ	h'0BF2
000741 0BF5 0000             	.dw	0
000742 0BF7 00               MENI:	.db	0	;equ	h'0BF7
000743 0BF8 00               MENF:	.db	0	;equ	h'0BF8
000744 0BF9 00               MENA:	.db	0	;equ	h'0BF9
000745 0BFA 00               MENL:	.db	0	;equ	h'0BFA
000746 0BFB 00               MENH:	.db	0	;equ	h'0BFB
000747 0BFC 00               MENE:	.db	0	;equ	h'0BFC
000748 0BFD 00               MEND:	.db	0	;equ	h'0BFD
000749 0BFE 00               MENC:	.db	0	;equ	h'0BFE
000750 0BFF 00               MENB:	.db	0	;equ	h'0BFF
000751 0C00 00               CURRMSG:	.db	0	;equ	MENB+1
000752 0C01                  
AJCOL   =00BC  
AJTEC   =00D7  
ALTA    =0223  
ALTB    =023A  
ALTC    =0251  
ALTCOM  =00EF  
ALTD    =0268  
ALTE    =027F  
ALTF    =02C4  
ALTH    =0296  
ALTI    =02E1  
ALTL    =02AD  
ALTREG  =0201  
ATRASO  =0001  
ATUAL   =013F  
BUFDISP =0BE7  
BYTES   =0BEB  
CURRMSG =0C00  
DECOD   =0151  
DELAY   =0340  
DELAY1  =0349  
DELAY2  =034B  
DISPLY  =016B  
ENDISP  =0BED  
FLAG    =0BE6  
FORMAT  =0183  
INICIAL =01E6  
INICIO  =0017  
INTD    =018C  
INVALID =0358  
INVAMSG =0376  
LOOP1   =00B2  
MENA    =0BF9  
MENB    =0BFF  
MENC    =0BFE  
MENCON  =0BE5  
MEND    =0BFD  
MENE    =0BFC  
MENF    =0BF8  
MENH    =0BFB  
MENI    =0BF7  
MENL    =0BFA  
MENS    =005C  
NE1     =0023  
NE10    =00DD  
NE11    =00FC  
NE12    =01FA  
NE2     =0032  
NE3     =0077  
NE4     =0083  
NE5     =0052  
NE6     =0055  
NE7     =009F  
NE8     =00D5  
NE9     =00EA  
NMINT   =0066  
OK      =036D  
OKMSG   =037C  
PAE     =0BEF  
PBE     =0BEE  
PDIG    =0003  
PSEG    =0001  
PTEC    =0001  
RAME    =0160  
RECCOM  =0069  
REGA    =020C  
REGB    =022C  
REGC    =0243  
REGD    =025A  
REGE    =0271  
REGF    =02B6  
REGH    =0288  
REGI    =02CD  
REGL    =029F  
REST    =009B  
RIV     =02ED  
ROT     =0BF0  
ROTCD   =012E  
ROTCP   =010E  
ROTER   =01DE  
ROTLT   =011D  
ROTNMI  =0BF2  
ROTPER  =00F4  
ROTPR   =019C  
ROTRD   =01C4  
ROTSA   =021A  
ROTUL   =01AC  
SELREG  =01F0  
TABALT  =0317  
TABCOM  =031B  
TABREG  =0300  
TEMPO   =00A8  
TOPSP   =0BE4  
VARR    =008F  
